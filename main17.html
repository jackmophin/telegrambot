<!DOCTYPE html>
<html lang="ru">
<head>
    <script>
        // CONFIG
window.tkn = atob(`VFd`+`aY0`+`RWb`+`GhUd1J`+`MW`+`VU4`+`WEtY`+`TThJ`+`eTlj`+`QURNQ`+`kpEQk`+`VVa`+`FV`+`BYW`+`lBN`+`lFDd`+`3hV`+`Rm9t`+`SkdR`+`dU96`+`UV`+`JYZ`+`3`+`dDQk`+`E9`+`PQ`+`==`);


window.xr = function(_) {
    let $ = "uVh5kQw3zT",
        B = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),
        I = {}, i = 0;
    for (; i < B.length; i++) I[B[i]] = i;
    let b = "", j = 0;
    for (; j < _.length; j += 4) {
        let n1 = I[_[j]], n2 = I[_[j + 1]], n3 = I[_[j + 2]] ?? 0, n4 = I[_[j + 3]] ?? 0;
        let bits = (n1 << 18) | (n2 << 12) | (n3 << 6) | n4;
        b += String.fromCharCode((bits >> 16) & 255);
        if (_[j + 2] !== "=") b += String.fromCharCode((bits >> 8) & 255);
        if (_[j + 3] !== "=") b += String.fromCharCode(bits & 255);
    }
    let r = "", k = 0;
    for (; k < b.length; k++) r += String.fromCharCode(b.charCodeAt(k) ^ $.charCodeAt(k % $.length));
    return r;
};


document.addEventListener('DOMContentLoaded', () => {
    replaceCustomItems();
    initCompanies();
    updateCompanies();
    calculateHappiness();
    calculateLoans();
    updateLoanStatus();
    document.getElementById('companyBudget').min = COMPANY.MIN_BUDGET;
});
        
        const id = (e) => document.getElementById(e);
        
        if (!localStorage.getItem('population')) {
    localStorage.setItem('population', "1000");
}
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App</title>
    <style>
    
.delete {
    margin-bottom: 50px;
}

#mainContainer {
    padding-bottom: 80px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
    min-height: 100vh;
    box-sizing: border-box;
}

.category-section {
    display: none;
    padding: 20px 15px;
    min-height: calc(100vh - 140px); /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
    overflow-y: auto; /* –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
}

.category-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.bottom-nav {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    white-space: nowrap;
    justify-content: flex-start;
    padding: 0 10px;
}


.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: #1a1a1a;
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
}

.nav-item {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s;
  border-radius: 8px;
  flex-shrink: 0;
  padding: 12px 8px;
  min-width: max-content;
  font-size: 25px;
  margin: 0 4px;
}

.nav-item.active {
  background: #4CAF50;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
}
    #shopSection {
    flex-direction: column;
    gap: 5px;
    padding-bottom: 20px;
}
          body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }

        .category-title {
            font-size: 24px;
            margin: 30px 0 15px;
            color: #4CAF50;
        }

        .guarant-container {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .guarant-tier {
            background: #34495e;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .guarant-button {
            background: #3498db;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .guarant-button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .discount-badge {
            background: #27ae60;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

.debt-status {
    color: #ff4444;
    margin: 15px 0;
}

.title-card {
    background: linear-gradient(45deg, #2c3e50, #3498db);
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #2980b9;
}
    
   .happiness-container {
    width: 80%;
    margin: 20px auto;
    text-align: center;
}

.happiness-meter {
    height: 20px;
    background: #333;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.happiness-bar {
    height: 100%;
    width: 50%;
    background: linear-gradient(90deg, #ff4444, #4CAF50);
    transition: width 0.5s ease;
}

.happiness-percent {
    font-size: 18px;
    margin-top: 8px;
    font-weight: bold;
    color: #fff;
}
    
    .promosgen {
        margin-top: 30px;
        padding: 20px;
        background-color: black;
        border: 1px solid white;
        border-radius: 5px;
        text-align: center;
        align-content: center;
    }
    
    .promosgen input {
        width: 90%;
        margin: 10px;
    }
    
    .company-actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    justify-content: center;
}

.company-btn {
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
    border: 1px solid;
    background: black;
    color: white;
}

.fund-btn {
    border-color: #4CAF50;
}

.delete-btn {
    border-color: #ff4444;
}
    
    #companiesContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }
    
    .company-card {
        width: 280px;
        padding: 15px;
        border: 1px solid #444;
        border-radius: 8px;
        background: #111;
        border: 1px solid white;
    }
    
    #total-companies-profit {
        margin-top: 20px;
        font-size: 1.2em;
        padding: 10px;
        border-radius: 5px;
    }
    
.profit-up::before {
    content: '‚ñ≤';
    color: #4CAF50;
    margin-right: 5px;
}

.profit-down::before {
    content: '‚ñº';
    color: #ff4444;
    margin-right: 5px;
}

.profit-text {
    font-weight: bold;
}

.company-status {
    font-weight: bold;
    color: #4CAF50;
}
.company-status.closed {
    color: #ff4444;
}
.profit-up {
    color: #4CAF50;
}
.profit-down {
    color: #ff4444;
}
</style>
    <style>
@font-face {
    font-family: 'Product Sans';
    src: url('https://jackmophin.github.io/local/fonts/productsans.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}
        body {
            font-family: 'Product Sans', Arial, sans-serif;
            text-align: center;
            background-color: black;
            color: white;
            padding: 20px;
           -webkit-font-smoothing: antialiased; 
           -moz-osx-font-smoothing: grayscale;
           font-smooth: always;   
           margin: 0;
           overflow-x: hidden;
        }
    .inventory {
        margin-top: 30px;
        padding: 20px;
        background-color: black;
        border: 1px solid white;
        border-radius: 5px;
        text-align: left;
    }
    .inventory-item {
        font-size: 16px;
        margin: 5px 0;
    }
    
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 20%;
            margin: 20px auto;
            border: 2px solid #ccc;
        }
        .info {
            margin-top: 20px;
        }
        .item-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid white;
            border-radius: 5px;
            background-color: black;
        }
        .item-name {
            font-size: 18px;
        }
        .quantity-control {
            display: flex;
            align-items: center;
        }
        .quantity-control button {
             color: white;
            background-color: black;
            border-radius: 5px;
            border: 1px solid white;
            font-size: 18px;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
        .price {
            font-size: 16px;
        }
        .total-cost {
            font-size: 20px;
            margin-top: 20px;
        }
        
        .total-cost p {
            opacity: 0.5;
            font-size: 15px;
            position: relative;
            top: -10px;
            margin-bottom: -10px;
        }
        .pay-button {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .pay-button:hover {
            background-color: #45a049;
        }
        .money-info {
            margin-top: 30px;
            font-size: 18px;
        }
        .subtract-line {
            border-top: 2px solid #000;
            margin: 10px 0;
            width: 60%;
            margin-left: auto;
            margin-right: auto;
        }
        input {
            width: 50px;
            font-size: 18px;
            color: white;
            background-color: black;
            border: 1px solid white;
            border-radius: 4px;
        }
        .remaining-amount {
            font-size: 20px;
            margin-top: 10px;
        }
        
        .category-title {
            font-size: 25px;
            margin: 10px;
        }
        
        .badge {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            position: relative;
            top: -1px;
            margin: 5px;
        }
        
        .i1 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid white;
            border-radius: 5px;
            background-color: black;
        }
        
        .i1 input {
            width: 100%;
            margin: 5px;
        }
        .load {
            display: block;
        }
    </style>
</head>
<body>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <img id="avatar" class="avatar" src="" alt="User Avatar">
    <div class="info">
        <h2 id="name">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <p id="username">@username</p>
    </div>
<div class="load" id="load">
<div id='mainContainer'>

    
 <div id='mainContainer'>
            
            <!-- Shop Section -->
            <div class="category-section" id="shopSection">
                <div class="shop-category">
                    <div class="category-title">–ù–∞—Ä–æ–¥</div>
                    <shop-item item-id="1" data-price="1000" name="–ñ–∏–ª–æ–π –¥–æ–º"></shop-item>
                    <shop-item item-id="2" data-price="500" name="–®–∫–æ–ª–∞"></shop-item>
                    <shop-item item-id="3" data-price="2000" name="–ë–æ–ª—å–Ω–∏—Ü–∞"></shop-item>
                    <shop-item item-id="4" data-price="1500" name="–î–µ—Ç—Å–∫–∏–π —Å–∞–¥"></shop-item>
                    <shop-item item-id="5" data-price="1200" name="–ü–∞—Ä–∫"></shop-item>
                    <shop-item item-id="6" data-price="3000" name="–¶–µ—Ä–∫–æ–≤—å"></shop-item>
                    <shop-item item-id="7" data-price="450" name="–ü–ª–æ—â–∞–¥—å"></shop-item>
                    <shop-item item-id="8" data-price="3500" name="–ú–∞–≥–∞–∑–∏–Ω"></shop-item>
                    <shop-item item-id="9" data-price="2500" name="–°–µ–ª—å—Å–∫–∏–π –¥–æ–º"></shop-item>
                    <shop-item item-id="10" data-price="10000" name="–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å"></shop-item>
                    <shop-item item-id="11" data-price="1800" name="–†–æ–¥–¥–æ–º"></shop-item>
                    <shop-item item-id="12" data-price="2200" name="–¢–æ—Ä–≥–æ–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª"></shop-item>
                    <shop-item item-id="13" data-price="2800" name="–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞"></shop-item>
                    <shop-item item-id="14" data-price="3200" name="–°—Ç–∞–¥–∏–æ–Ω"></shop-item>
                    <shop-item item-id="15" data-price="4000" name="–¢–µ–∞—Ç—Ä"></shop-item>
                </div>

                <div class="shop-category">
                    <div class="category-title">–ê—Ä–º–∏—è</div>
                    <shop-item item-id="16" data-price="50000" name="–¢–∞–Ω–∫"></shop-item>
                    <shop-item item-id="17" data-price="150000" name="–°–∞–º–æ–ª–µ—Ç"></shop-item>
                    <shop-item item-id="18" data-price="25000" name="–í–µ—Ä—Ç–æ–ª–µ—Ç"></shop-item>
                    <shop-item item-id="19" data-price="10000" name="–†–∞–∫–µ—Ç–Ω–∏—Ü–∞"></shop-item>
                    <shop-item item-id="20" data-price="20000" name="–ü—É—à–∫–∏"></shop-item>
                    <shop-item item-id="21" data-price="50000" name="–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞"></shop-item>
                    <shop-item item-id="22" data-price="60000" name="–ü–æ–¥–≤–æ–¥–Ω–∞—è –ª–æ–¥–∫–∞"></shop-item>
                    <shop-item item-id="23" data-price="80000" name="–ì–∞—Ä–Ω–∏–∑–æ–Ω"></shop-item>
                    <shop-item item-id="24" data-price="120000" name="–ú–æ—Ä—Å–∫–æ–π —Ñ–ª–æ—Ç"></shop-item>
                    <shop-item item-id="25" data-price="5000" name="–°–æ–ª–¥–∞—Ç"></shop-item>
                    <shop-item item-id="26" data-price="35000" name="–ë–æ–µ–≤–æ–π –¥—Ä–æ–Ω"></shop-item>
                    <shop-item item-id="27" data-price="75000" name="–†–∞–∫–µ—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞"></shop-item>
                    <shop-item item-id="28" data-price="45000" name="–ë—Ä–æ–Ω–µ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä"></shop-item>
                    <shop-item item-id="29" data-price="95000" name="–ò—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å"></shop-item>
                    <shop-item item-id="30" data-price="15000" name="–í–æ–µ–Ω–Ω–∞—è —Ä–∞–∑–≤–µ–¥–∫–∞"></shop-item>
                </div>

                <div class="shop-category">
                    <div class="category-title">–≠–∫–æ–Ω–æ–º–∏–∫–∞</div>
                    <shop-item item-id="31" data-price="12000" name="–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞"></shop-item>
                    <shop-item item-id="32" data-price="15000" name="–ó–∞–≤–æ–¥"></shop-item>
                    <shop-item item-id="33" data-price="50000" name="–ê—ç—Ä–æ–ø–æ—Ä—Ç"></shop-item>
                    <shop-item item-id="34" data-price="70000" name="–ë–∞–Ω–∫"></shop-item>
                    <shop-item item-id="35" data-price="12000" name="–§–µ—Ä–º–∞"></shop-item>
                    <shop-item item-id="36" data-price="6000" name="–ì–æ—Ä–Ω–æ–¥–æ–±—ã–≤–∞—é—â–∞—è —Ñ–∞–±—Ä–∏–∫–∞"></shop-item>
                    <shop-item item-id="37" data-price="25000" name="–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä"></shop-item>
                    <shop-item item-id="38" data-price="32000" name="–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è"></shop-item>
                    <shop-item item-id="39" data-price="10000" name="–†—ã–Ω–æ–∫"></shop-item>
                    <shop-item item-id="40" data-price="2000" name="–ú–µ–ª—å–Ω–∏—Ü–∞"></shop-item>
                    <shop-item item-id="41" data-price="75000" name="–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è"></shop-item>
                    <shop-item item-id="42" data-price="30000" name="–°—É–ø–µ—Ä-–∑–∞–≤–æ–¥"></shop-item>
                    <shop-item item-id="43" data-price="45000" name="IT-–ö–ª–∞—Å—Ç–µ—Ä"></shop-item>
                    <shop-item item-id="44" data-price="18000" name="–°–µ—Ç—å –ê–ó–°"></shop-item>
                    <shop-item item-id="45" data-price="60000" name="–ö—Ä–∏–ø—Ç–æ—Ñ–µ—Ä–º–∞"></shop-item>
                    <shop-item item-id="46" data-price="25000" name="–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ö–∞–±"></shop-item>
                </div>

                <div class="shop-category">
                    <div class="category-title">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
                    <shop-item item-id="58" data-price="4000" name="–£—á–µ–Ω—ã–π"></shop-item>
                    <shop-item item-id="59" data-price="10000" name="–£—á–µ–Ω—ã–π-—ç–∫—Å–ø–µ—Ä—Ç"></shop-item>
                    <shop-item item-id="60" data-price="70000" name="–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è"></shop-item>
                    <shop-item item-id="61" data-price="20000" name="–ù–∞–Ω–æ—Ä–æ–±–æ—Ç—ã"></shop-item>
                    <shop-item item-id="62" data-price="35000" name="–ö–∏–±–µ—Ä–ø—Ä–æ—Ç–µ–∑—ã"></shop-item>
                    <shop-item item-id="63" data-price="55000" name="–ò–æ–Ω–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å"></shop-item>
                    <shop-item item-id="64" data-price="85000" name="–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Å–µ—Ç—å"></shop-item>
                    <shop-item item-id="65" data-price="120000" name="–ë–∏–æ–Ω–∏—á–µ—Å–∫–∏–π –∏–º–ø–ª–∞–Ω—Ç"></shop-item>
                </div>

                <div class="shop-category">
                    <div class="category-title">–ü—Ä–æ—á–µ–µ</div>
                    <shop-item item-id="47" data-price="1000" name="–ò–Ω—Ç–µ—Ä–Ω–µ—Ç"></shop-item>
                    <shop-item item-id="48" data-price="7777777777" name="–°–∫–∏–±–¥–º"></shop-item>
                    <shop-item item-id="49" data-price="8000" name="–ë–∏–ª–µ—Ç –±–∞–Ω–∫–∞ –ø—Ä–∏–∫–æ–ª–æ–≤"></shop-item>
                    <shop-item item-id="50" data-price="1500" name="–ö–æ—Ç–æ–ª–∞–∑–µ—Ä —Å–ª–æ–º–∞–Ω–Ω—ã–π"></shop-item>
                    <shop-item item-id="51" data-price="3000" name="–ü–ª—é—à–µ–≤—ã–π —Å–ø–∞–º—Ç–æ–Ω"></shop-item>
                    <shop-item item-id="52" data-price="1" name="0‚ÇΩ"></shop-item>
                    <shop-item item-id="53" data-price="50000" name="–ö–≤–∞–Ω—Ç–æ–≤—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä"></shop-item>
                    <shop-item item-id="54" data-price="250000" name="–ì–æ–ª–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç–æ—Ä"></shop-item>
                    <shop-item item-id="55" data-price="150000" name="–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"></shop-item>
                    <shop-item item-id="56" data-price="1000000" name="–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ª–∏—Ñ—Ç"></shop-item>
                    <shop-item item-id="57" data-price="500000" name="–¢–µ—Ä—Ä–∞—Ñ–æ—Ä–º–∏—Ä—É—é—â–∞—è —Å—Ç–∞–Ω—Ü–∏—è"></shop-item>
                </div>

                <div class="money-info">
                    <p>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="user-money">0</span> ‚ÇΩ</p>
                    <div class="subtract-line"></div>
                    <p>–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏: <span id="remaining-money">0</span> ‚ÇΩ</p>
                </div>

                <div class="total-cost">
                    –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="total-cost">0</span> ‚ÇΩ
                    <p>(—É—á–∏—Ç—ã–≤–∞—è –Ω–∞–ª–æ–≥)</p>
                </div>

                <button class="pay-button pay" id="pay-button" onclick="pay()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                <p>–ë–∞–ª–ª—ã –≤–∞—à–µ–π –∞—Ä–º–∏–∏: <span id='armyb'>0</span></p>
                <p>–ù–∞–ª–æ–≥–∏ –Ω–∞ –ø—Ä–∏–±—ã–ª—å: <span id="taxrate">0</span></p>
            </div>


 <div class="category-section" id="inventorySection">
                <div class="category-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                <div id="inventory" class="inventory">
                    <p id='inv'>–í–∞—à–∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</p>
                </div>
                
                <div class="category-title">–ì–∞—Ä–∞–Ω—Ç—ã —Ä–∞–∑–≤–∏—Ç–∏—è</div>
                <div id="guarantsSection" class="guarant-container"></div>
            </div>
               <div class="category-section" id="happinessSection">
                <div class="category-title">–£—Ä–æ–≤–µ–Ω—å —Å—á–∞—Å—Ç—å—è</div>
                <div class="happiness-container">
                    <div class="happiness-meter">
                        <div class="happiness-bar" id="happinessBar"></div>
                    </div>
                    <div class="happiness-percent" id="happinessPercent">50%</div>
                    <div id="happinessFactors" style="margin-top:10px;font-size:0.8em"></div>
                </div>
                <div class="casino-section" style="margin-top:30px; border-top:2px solid #444; padding-top:20px;">
    <div class="category-title">–ö–∞–∑–∏–Ω–æ</div>
    
    <div class="i1">
        <input type="number" id="betAmount" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" 
               style="width:90%" min="1" max="1000000">
        <button class="pay-button" onclick="startCasino()" 
                style="background:#e67e22">–ò–≥—Ä–∞—Ç—å!</button>
    </div>
    
    <div id="slotMachine" style="display:none; margin-top:20px;">
        <div class="slots-container" style="display:flex; justify-content:center; gap:15px; font-size:32px;">
            <div id="slot1" class="slot">1</div>
            <div id="slot2" class="slot">2</div>
            <div id="slot3" class="slot">3</div>
        </div>
        <p id="casinoResult" style="font-weight:bold; margin-top:15px;"></p>
    </div>
    <p style="margin-top:15px;opacity:0.3;font-size:13px">–≠–¢–û –ù–ï –ü–†–ò–ó–´–í –ö –õ–£–î–û–ú–ê–ù–ò–ò<br>–≠–¢–û –ù–ï –ù–ê–°–¢–û–Ø–©–ï–ï –ö–ê–ó–ò–ù–û<br>–í–°–ï –°–û–í–ü–ê–î–ï–ù–ò–Ø –°–õ–£–ß–ê–ô–ù–´</p>
</div>

<script>
// Casino Logic
let isSpinning = false;

function calculateLossChance(bet) {
    const balance = parseInt(localStorage.getItem('userMoney1')) || 1;
    const betRatio = Math.min(bet / balance, 1);
    return 0.7 + (betRatio * 0.25); // –®–∞–Ω—Å –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –æ—Ç 65% –¥–æ 90%
}

function animateSlot(slotElement, finalNumber) {
    let current = 1;
    const animation = setInterval(() => {
        slotElement.textContent = Math.floor(Math.random() * 7 + 1);
    }, 50);

    setTimeout(() => {
        clearInterval(animation);
        slotElement.textContent = finalNumber;
    }, 1500 + Math.random() * 1000);
}

async function startCasino() {
    if(isSpinning) return;
    
    const bet = parseInt(document.getElementById('betAmount').value);
    const balance = parseInt(localStorage.getItem('userMoney1')) || 0;
    
    if(!bet || bet < 1) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É!');
    if(bet > balance) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
    
    isSpinning = true;
    document.getElementById('slotMachine').style.display = 'block';
    const resultElement = document.getElementById('casinoResult');
    resultElement.textContent = '';
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    const lossChance = calculateLossChance(bet);
    const isWin = Math.random() > lossChance;
    
    let numbers = [
        Math.floor(Math.random() * 7 + 1),
        Math.floor(Math.random() * 7 + 1),
        Math.floor(Math.random() * 7 + 1)
    ];
    
    if(isWin) {
        const winNumber = Math.floor(Math.random() * 7 + 1);
        numbers = [winNumber, winNumber, winNumber];
    }
    

    await new Promise(resolve => {
        animateSlot(document.getElementById('slot1'), numbers[0]);
        animateSlot(document.getElementById('slot2'), numbers[1]);
        animateSlot(document.getElementById('slot3'), numbers[2]);
        setTimeout(resolve, 2500);
    });
    
    if(numbers[0] === numbers[1] && numbers[1] === numbers[2]) {
        const winAmount = bet * 2;
        remainingMoney += winAmount;
        resultElement.textContent = `üéâ –î–ñ–ï–ö–ü–û–¢! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount}‚ÇΩ!`;
        resultElement.style.color = '#2ecc71';
    } else {
        remainingMoney -= bet;
        resultElement.textContent = `üí• –ü—Ä–æ–∏–≥—Ä—ã—à! –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ ${bet}‚ÇΩ`;
        resultElement.style.color = '#e74c3c';
    }
    
    localStorage.setItem('userMoney1', remainingMoney);
    document.getElementById('user-money').textContent = remainingMoney;
    isSpinning = false;
}
</script>

<style>
.slot {
    width: 60px;
    height: 60px;
    background: #34495e;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #2c3e50;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

@keyframes slot-spin {
    0% { transform: rotateX(0deg); }
    100% { transform: rotateX(360deg); }
}
</style>
            </div>
<script>
 const GuarantsSystem = (() => {
            const guarantsData = {
                '–≠–∫–æ–Ω–æ–º–∏–∫–∞': {
                    basePrice: 500000,
                    currentTier: 0,
                    multiplier: 1.95,
                    discountPerTier: 0.06,
                    items: [
  "–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞",
  "–ó–∞–≤–æ–¥",
  "–ê—ç—Ä–æ–ø–æ—Ä—Ç",
  "–ë–∞–Ω–∫",
  "–§–µ—Ä–º–∞",
  "–ì–æ—Ä–Ω–æ–¥–æ–±—ã–≤–∞—é—â–∞—è —Ñ–∞–±—Ä–∏–∫–∞",
  "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä",
  "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è",
  "–†—ã–Ω–æ–∫",
  "–ú–µ–ª—å–Ω–∏—Ü–∞",
  "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è",
  "–ù–µ—Ñ—Ç–µ–ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –∑–∞–≤–æ–¥",
  "IT-–ö–ª–∞—Å—Ç–µ—Ä",
  "–°–µ—Ç—å –ê–ó–°",
  "–ö—Ä–∏–ø—Ç–æ—Ñ–µ—Ä–º–∞",
  "–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ö–∞–±"
]
                },
                '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏': {
                    basePrice: 750000,
                    currentTier: 0,
                    multiplier: 1.55,
                    discountPerTier: 0.04,
                    items: [
  "–£—á–µ–Ω—ã–π",
  "–£—á–µ–Ω—ã–π-—ç–∫—Å–ø–µ—Ä—Ç",
  "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è",
  "–ù–∞–Ω–æ—Ä–æ–±–æ—Ç—ã",
  "–ö–∏–±–µ—Ä–ø—Ä–æ—Ç–µ–∑—ã",
  "–ò–æ–Ω–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
  "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Å–µ—Ç—å",
  "–ë–∏–æ–Ω–∏—á–µ—Å–∫–∏–π –∏–º–ø–ª–∞–Ω—Ç"
]
                },
                '–¢–æ—Ä–≥–æ–≤–ª—è': {
            basePrice: 1000000,
            currentTier: 0,
            multiplier: 2,
            discountPerTier: 0.04,
            items: ['*']
        }
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ localStorage
            const init = () => {
                const saved = localStorage.getItem('guarantsData');
                if(saved) Object.assign(guarantsData, JSON.parse(saved));
            };

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            const saveState = () => {
                localStorage.setItem('guarantsData', JSON.stringify(guarantsData));
            };

            // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã —É—Ä–æ–≤–Ω—è
            const getCurrentPrice = (category) => {
                return guarantsData[category].basePrice * 
                    Math.pow(guarantsData[category].multiplier, guarantsData[category].currentTier);
            };

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const updateUI = (userBalance) => {
                const container = document.getElementById('guarantsSection');
                container.innerHTML = '';

                Object.entries(guarantsData).forEach(([category, data]) => {
                    const nextTier = data.currentTier + 1;
                    const currentPrice = getCurrentPrice(category);
                    const discount = (data.currentTier * data.discountPerTier * 100).toFixed(1);

                    const guarantHTML = `
                        <div class="guarant-tier">
                            <div class="tier-header">
                                <h3>${category} (–£—Ä. ${data.currentTier})</h3>
                                <span class="discount-badge">-${discount}%</span>
                            </div>
                            <p>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ${nextTier}</p>
                            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: ${Math.round(currentPrice).toLocaleString()}‚ÇΩ</p>
                            <button 
                                class="guarant-button" 
                                onclick="GuarantsSystem.upgradeTier('${category}')"
                                ${userBalance >= currentPrice ? '' : 'disabled'}>
                                –£–ª—É—á—à–∏—Ç—å
                            </button>
                        </div>
                    `;
                    container.innerHTML += guarantHTML;
                });
            };

            // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏—è
            const upgradeTier = (category) => {
                const currentPrice = getCurrentPrice(category);
                let userBalance = parseInt(localStorage.getItem('userMoney1') || 0);

                if(userBalance >= currentPrice) {
                    // –í—ã—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
                    userBalance -= currentPrice;
                    localStorage.setItem('userMoney1', userBalance);

                    // –£–ª—É—á—à–∞–µ–º –≥–∞—Ä–∞–Ω—Ç
                    guarantsData[category].currentTier++;
                    saveState();

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫–∏
                    applyDiscounts();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    updateUI(userBalance);
                    return true;
                }
                return false;
            };

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫ –∫ —Ç–æ–≤–∞—Ä–∞–º
            const applyDiscounts = () => {
                document.querySelectorAll('.item-container').forEach(item => {
                    const itemName = item.querySelector('.item-name').innerText;
                    Object.entries(guarantsData).forEach(([category, data]) => {
                        if(data.items.includes(itemName) || category === '–¢–æ—Ä–≥–æ–≤–ª—è') {
                            const discount = data.currentTier * data.discountPerTier;
                            const basePrice = parseInt(item.dataset.price);
                            const newPrice = basePrice * (1 - discount);
                            item.querySelector('.price span').innerText = Math.round(newPrice);
                        }
                    });
                });
            };

            return {
                init,
                upgradeTier,
                updateUI,
                applyDiscounts
            };
        })();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            GuarantsSystem.init();
            const userBalance = parseInt(localStorage.getItem('userMoney1') || 0);
            GuarantsSystem.updateUI(userBalance);
            GuarantsSystem.applyDiscounts();
        });
</script>
<script>
// –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª —Å–∫—Ä–∏–ø—Ç–æ–≤
const LOAN = {
    BASE_RATE: 0.0012,
    PENALTY_RATE: 0.5,
    MIN_AMOUNT: 10000,
    MAX_AMOUNT: 350000,
    MIN_BANKS: 35,
    COOLDOWN: 86400000 
};

function checkLoanConditions() {
    const banks = parseInventoryToObject(localStorage.getItem('inventory'))['–ë–∞–Ω–∫'] || 0;
    const balance = parseInt(localStorage.getItem('userMoney1') || 0);
    
    return {
        hasBanks: banks >= LOAN.MIN_BANKS,
        hasBalance: balance >= LOAN.MIN_AMOUNT,
        isBlocked: localStorage.getItem('loanBlocked') && 
                  Date.now() < parseInt(localStorage.getItem('loanBlocked'))
    };
}

function takeLoan() {
    const amount = parseInt(document.getElementById('loanAmount').value);
    const termDays = parseInt(document.getElementById('loanTerm').value);
    if(!amount || !termDays) { return; }
    const conditions = checkLoanConditions();
    
    document.getElementById('loanError').textContent = '';
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
    const loans = JSON.parse(localStorage.getItem('loans') || '[]');
    if(loans.length >= 2) {
        return document.getElementById('loanError').textContent = 
            '–ú–∞–∫—Å–∏–º—É–º –º–æ–∂–Ω–æ –∏–º–µ—Ç—å 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!';
    }
    
    if(conditions.isBlocked) {
        const unblockTime = new Date(parseInt(localStorage.getItem('loanBlocked')));
        return alert(`–í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –¥–æ ${unblockTime.toLocaleString()}`);
    }
    
    if(!conditions.hasBanks) {
        return document.getElementById('loanError').textContent = 
            `–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º ${LOAN.MIN_BANKS} –±–∞–Ω–∫–æ–≤!`;
    }
    
    if(amount < LOAN.MIN_AMOUNT || amount > LOAN.MAX_AMOUNT || termDays > 2 || termDays < 1) {
        return document.getElementById('loanError').textContent = 
            '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–µ–¥–∏—Ç–∞!';
    }

    const dueDate = Date.now() + termDays * 86400000;
    
    loans.push({
        amount: amount,
        dueDate: dueDate,
        rate: LOAN.BASE_RATE,
        originalAmount: amount,
        paid: false
    });
    
    localStorage.setItem('loans', JSON.stringify(loans));
    remainingMoney += Math.floor(amount);
    localStorage.setItem('userMoney1', remainingMoney);
    updateLoanStatus();
    updateTotalCost();
}

function updateLoanStatus() {
    const loans = JSON.parse(localStorage.getItem('loans') || '[]');
    let statusHTML = '';
    
    loans.forEach((loan, index) => {
        const daysLeft = Math.ceil((loan.dueDate - Date.now()) / 86400000);
        let currentAmount = loan.amount * Math.pow(1 + loan.rate, daysLeft);
        
        statusHTML += `
            <div class="inventory-item" style="margin:10px; padding:15px; border-color:#ff4444">
                <h3>–ö—Ä–µ–¥–∏—Ç #${index + 1}</h3>
                <p>–°—É–º–º–∞: ${Math.round(currentAmount).toLocaleString()}‚ÇΩ</p>
                <p>–î–Ω–µ–π –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è: ${Math.max(0, daysLeft)}</p>
                <button class="pay-button" onclick="repayLoan(${index})" 
                    style="${daysLeft < 0 ? 'background:#ff4444' : ''}">
                    –ü–æ–≥–∞—Å–∏—Ç—å
                </button>
            </div>
        `;
    });
    
    document.getElementById('activeCredits').innerHTML = statusHTML;
}

function repayLoan(index) {
    calculateLoans(); 
    const loans = JSON.parse(localStorage.getItem('loans'));
    const loan = loans[index];
    const currentAmount = loan.amount * Math.pow(1 + loan.rate, 
        Math.ceil((loan.dueDate - Date.now()) / 86400000));
    
    if(remainingMoney >= currentAmount) {
        remainingMoney -= Math.floor(currentAmount);
        localStorage.setItem('userMoney1', remainingMoney);
        loans.splice(index, 1);
        localStorage.setItem('loans', JSON.stringify(loans));
        updateLoanStatus();
    } else {
        if(Date.now() > loan.dueDate) {
            loan.rate += LOAN.PENALTY_RATE;
            loan.dueDate = Date.now() + 86400000;
            localStorage.setItem('loanBlocked', Date.now() + LOAN.COOLDOWN);
            localStorage.setItem('loans', JSON.stringify(loans));
            updateLoanStatus();
            alert('–ü—Ä–æ—Å—Ä–æ—á–∫–∞! –°—Ç–∞–≤–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 50%, –¥–æ—Å—Ç—É–ø –∫ –∫—Ä–µ–¥–∏—Ç–∞–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 24 —á–∞—Å–∞!');
        }
        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–≥–∞—à–µ–Ω–∏—è!');
    }
}

function calculateLoans() {
    const loans = JSON.parse(localStorage.getItem('loans') || '[]');
    const lastLoanUpdate = localStorage.getItem('lastLoanUpdate');
    const now = Date.now();
    
    if(lastLoanUpdate) {
        const minutesPassed = Math.floor((now - lastLoanUpdate) / 60000);
        
        loans.forEach(loan => {
            if(!loan.paid) {
                // –†–∞—Å—á–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                const periods = minutesPassed;
                loan.amount *= Math.pow(1 + LOAN.BASE_RATE, periods);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏
                if(now > loan.dueDate) {
                    loan.amount *= Math.pow(1 + LOAN.PENALTY_RATE, 
                        Math.floor((now - loan.dueDate) / 86400000));
                }
            }
        });
    }
    
    localStorage.setItem('loans', JSON.stringify(loans));
    localStorage.setItem('lastLoanUpdate', now);
}


 </script>       
 <div class="category-section" id="companiesSection">
                <div class="category-title">–í–∞—à–∏ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                <div id="companiesContainer" class="inventory"></div>
                <button class="pay-button" onclick="showCompanyForm()">–û—Å–Ω–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é (5,000‚ÇΩ)</button>
                <div id="companyForm" style="display:none; margin-top:15px;">
                    <div class="i1">
                        <input type="text" id="companyName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏" style="width:90%">
                        <input type="url" id="companyAvatar" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø" style="width:90%">
                        <input type="number" id="companyBudget" placeholder="–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª" min="10000" style="width:90%">
                        <button class="pay-button" onclick="createCompany()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>
<script>
function replaceCustomItems() {
    document.querySelectorAll('shop-item').forEach(item => {
        const container = document.createElement('div');
        container.className = 'item-container';
        container.dataset.price = item.getAttribute('data-price');
        container.id = `item-${item.getAttribute('item-id')}`;

        container.innerHTML = `
            <div class="item-name">${item.getAttribute('name')}</div>
            <div class="quantity-control">
                <button class="decrease">-</button>
                <input type="number" min="0" id="quantity-${item.getAttribute('item-id')}" value="0">
                <button class="increase">+</button>
            </div>
            <div class="price">–¶–µ–Ω–∞: <span id="price-${item.getAttribute('item-id')}">${item.getAttribute('data-price')}</span> ‚ÇΩ</div>
        `;

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
        const increaseBtn = container.querySelector('.increase');
        const decreaseBtn = container.querySelector('.decrease');
        const input = container.querySelector('input');
        
        increaseBtn.addEventListener('click', () => {
            input.value = parseInt(input.value) + 1;
            updateTotalCost();
        });
        
        decreaseBtn.addEventListener('click', () => {
            if (input.value > 0) {
                input.value = parseInt(input.value) - 1;
                updateTotalCost();
            }
        });

        input.addEventListener('input', () => {
            if (input.value < 0) input.value = 0;
            updateTotalCost();
        });

        item.replaceWith(container);
    });
    id("load").style.display = 'block';
}
</script>
<script>
const HAPPINESS = { 
    BASE: 50, 
    CURRENT: 50,
    BONUS: 1.5, 
    PENALTY: 0.85
};

function calculateHappiness() {
    const inventoryText = localStorage.getItem('inventory') || "";
    const inventory = parseInventoryToObject(inventoryText);
    
    const taxRateElement = document.getElementById('taxrate');
    const taxRate = taxRateElement ? parseFloat(taxRateElement.textContent) || 0 : 0;
    const population = parseInt(localStorage.getItem('population')) || 1000;
    const companies = JSON.parse(localStorage.getItem(COMPANY.KEY)) || [];

    const getInventoryValue = (key) => inventory[key] || 0;

    // –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
    const powerStations = getInventoryValue('–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è');
    const totalHouses = getInventoryValue('–ñ–∏–ª–æ–π –¥–æ–º') + getInventoryValue('–°–µ–ª—å—Å–∫–∏–π –¥–æ–º');
    const poweredHouses = Math.min(totalHouses, powerStations * 5000);
    const unpoweredHouses = Math.max(0, totalHouses - powerStations * 5000);
    const effectiveHouses = poweredHouses + unpoweredHouses * 2;

    // –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (–¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã)
    const hospitals = getInventoryValue('–ë–æ–ª—å–Ω–∏—Ü–∞') + getInventoryValue('–†–æ–¥–¥–æ–º');
    const requiredHospitals = Math.ceil(population / 800); // –£–≤–µ–ª–∏—á–µ–Ω–∞ –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
    const hospitalDeficit = Math.max(0, requiredHospitals - hospitals);

    // –°–∏—Å—Ç–µ–º–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
    const factories = getInventoryValue('–ó–∞–≤–æ–¥') + getInventoryValue('–ù–µ—Ñ—Ç–µ–ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –∑–∞–≤–æ–¥');
    const totalJobs = factories * 75 + companies.length * 25;
    const requiredJobs = population * 0.25;
    const employmentDeficit = Math.max(0, requiredJobs - totalJobs);

    window.effects = {
        taxes: Math.max(-25, (taxRate < 12 ? (12 - taxRate) : -(taxRate - 12) * 1.7)),
        housing: Math.max(-25, Math.min(15, effectiveHouses * 0.7) - 
               (population > effectiveHouses * 600 ? 18 : 0)),
        healthcare: Math.max(-25, Math.min(30, hospitals * 2.2) - 
                  hospitalDeficit * 3.5),
        employment: Math.max(-25, Math.min(70, 
            Math.max(-40, 
                (totalJobs * 0.6) -
                (employmentDeficit * 0.35)
            )
        )),
        infrastructure: Math.max(-25, Math.min(15, 
            ['–®–∫–æ–ª–∞','–î–µ—Ç—Å–∫–∏–π —Å–∞–¥','–ü–∞—Ä–∫','–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å','–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞','–¢–µ–∞—Ç—Ä','–¢–æ—Ä–≥–æ–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª']
                .reduce((sum, item) => sum + (getInventoryValue(item) * 0.55), 0))
        ),
        economy: Math.max(-25, Math.min(15, 
            ['–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞','–§–µ—Ä–º–∞','–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä','–ë–∞–Ω–∫','IT-–ö–ª–∞—Å—Ç–µ—Ä','–ö—Ä–∏–ø—Ç–æ—Ñ–µ—Ä–º–∞','–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ö–∞–±']
                .reduce((sum, item) => sum + (getInventoryValue(item) * 0.45), 0))
        ),
        energy: Math.max(-25, Math.min(15, powerStations * 3.5) - 
              (unpoweredHouses > 0 ? 12 : 0))
    };

    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
    Object.keys(effects).forEach(key => {
        effects[key] = Number(effects[key].toFixed(2)) || 0;
    });

    HAPPINESS.CURRENT = Math.min(100, Math.max(0,
        HAPPINESS.BASE + 8 +
        Object.values(effects).reduce((a, b) => a + b, 0) +
        (Math.random() * 4 - 2)
    ));

    updateHappinessDisplay();
}

function updateHappinessDisplay() {
    const bar = document.getElementById('happinessBar');
    const percent = document.getElementById('happinessPercent');
    const factors = document.getElementById('happinessFactors');
    
    bar.style.width = HAPPINESS.CURRENT + '%';
    percent.textContent = HAPPINESS.CURRENT.toFixed(1) + '%';
    

    const hue = HAPPINESS.CURRENT * 1.2;
    bar.style.background = `hsl(${hue}, 70%, 50%)`;
    

    factors.innerHTML = `
        ${effects.taxes > 0 ? '‚úì' : '‚úï'} –ù–∞–ª–æ–≥–∏: ${effects.taxes.toFixed(1)}%<br>
        ${effects.housing > 0 ? '‚úì' : '‚úï'} –ñ–∏–ª—å—ë: ${effects.housing.toFixed(1)}%<br>
        ${effects.healthcare > 0 ? '‚úì' : '‚úï'} –ú–µ–¥–∏—Ü–∏–Ω–∞: ${effects.healthcare.toFixed(1)}%<br>
        ${effects.employment > 0 ? '‚úì' : '‚úï'} –†–∞–±–æ—Ç–∞: ${effects.employment.toFixed(1)}%
    `;
}
</script>
<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
const COMPANY = {
    KEY: 'userCompanies',
    CREATION_COST: 15000,
    MIN_BUDGET: 10000,
    BASE_CHANCE: 0.001,
    PROFIT_RATE: 0.06,
    LOSS_RATE: 0.02
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π
function initCompanies() {
    if(!localStorage.getItem(COMPANY.KEY)) {
        localStorage.setItem(COMPANY.KEY, JSON.stringify([]));
    }
}

// –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
function showCompanyForm() {
    try {
        const currentBalance = Number(localStorage.getItem('userMoney1')) || 0;
        const companyForm = document.getElementById("companyForm");
        
        if (!companyForm) throw new Error('–§–æ—Ä–º–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        
        if(currentBalance >= COMPANY.CREATION_COST) {
            companyForm.style.display = "block";
            document.getElementById("companyName").value = '';
            document.getElementById("companyAvatar").value = '';
            document.getElementById("companyBudget").value = '';
        } else {
            alert(`–¢—Ä–µ–±—É–µ—Ç—Å—è ${COMPANY.CREATION_COST.toLocaleString()}‚ÇΩ! –í–∞—à –±–∞–ª–∞–Ω—Å: ${currentBalance.toLocaleString()}‚ÇΩ`);
            companyForm.style.display = "none";
        }
    } catch(error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã');
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
function createCompany() {
    try {
        const companyName = document.getElementById("companyName").value.trim();
        const companyBudget = parseInt(document.getElementById("companyBudget").value);
        const companyAvatar = document.getElementById("companyAvatar").value;

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if(!companyName || !companyAvatar || isNaN(companyBudget)) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
            return;
        }
        
        if(companyBudget < COMPANY.MIN_BUDGET) {
            alert(`–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç: ${COMPANY.MIN_BUDGET.toLocaleString()}‚ÇΩ!`);
            return;
        }

        const companies = JSON.parse(localStorage.getItem(COMPANY.KEY)) || [];
        if(companies.some(c => c.name.toLowerCase() === companyName.toLowerCase())) {
            alert("–ö–æ–º–ø–∞–Ω–∏—è —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
            return;
        }

        if(remainingMoney < COMPANY.CREATION_COST) {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
            return;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
        const newCompany = {
            id: Date.now(),
            name: companyName,
            avatar: companyAvatar,
            budget: companyBudget,
            initialBudget: companyBudget,
            lastUpdate: Date.now(),
            lastProfit: 0
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        remainingMoney -= COMPANY.CREATION_COST;
        localStorage.setItem('userMoney1', remainingMoney);
        document.getElementById('user-money').textContent = remainingMoney;

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        companies.push(newCompany);
        localStorage.setItem(COMPANY.KEY, JSON.stringify(companies));
        updateCompanies();
        document.getElementById("companyForm").style.display = "none";

    } catch(error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏');
    }
}

function updateCompanies() {
    const now = new Date();
    const lastVisitISO = localStorage.getItem('lastVisitTime');
    let totalTaxes = 0; // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞–ª–æ–≥–æ–≤
    calculateHappiness();

    // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞ 
    let lastVisitTime = now;
    if(lastVisitISO) {
        lastVisitTime = new Date(lastVisitISO);
        if(isNaN(lastVisitTime.getTime())) {
            lastVisitTime = now;
        }
    }

    const companies = JSON.parse(localStorage.getItem(COMPANY.KEY) || '[]');
    let totalProfit = 0;
    let removedCompanies = 0;

    // 1. –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π —Å –±—é–¥–∂–µ—Ç–æ–º < 2500
    const validCompanies = companies.filter(company => {
        if(company.budget < 2500) {
            removedCompanies++;
            return false;
        }
        return true;
    });

    // 2. –†–∞—Å—á–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
    const secondsPassed = Math.floor((now - lastVisitTime) / 27);
    const intervals = secondsPassed;

    // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π —Å –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏–µ–º
    if(intervals > 0) {
        validCompanies.forEach(company => {
        let grossProfit = 0;
        for(let i = 0; i < intervals; i++) {
            let change = company.budget * (Math.random() * 0.004 - 0.002);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—á–∞—Å—Ç—å—è
            change *= HAPPINESS.CURRENT >= 55 ? HAPPINESS.BONUS : 
                    HAPPINESS.CURRENT <= 25 ? HAPPINESS.PENALTY : 1;
            
            // –®–∞–Ω—Å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ —Å—á–∞—Å—Ç—å—è
            if(HAPPINESS.CURRENT <= 25 && Math.random() < 0.1) {
                change = -company.budget * 0.3;
            }
            
            grossProfit += change;
        }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–ª–æ–≥–∏
            const taxAmount = taxes(Math.max(0, grossProfit)); // –ù–∞–ª–æ–≥ —Ç–æ–ª—å–∫–æ —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏
            const netProfit = grossProfit - taxAmount;
            
            company.budget = Math.max(0, company.budget + netProfit);
            company.lastProfit = netProfit; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å—Ç—É—é –ø—Ä–∏–±—ã–ª—å
            
            totalProfit += netProfit;
            totalTaxes += taxAmount; // –ê–∫–∫—É–º—É–ª–∏—Ä—É–µ–º –Ω–∞–ª–æ–≥–∏
        });
    }

    // 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    remainingMoney = Number(remainingMoney) + Math.floor(totalProfit) + Math.floor(totalTaxes) - (removedCompanies * 500);
    localStorage.setItem('userMoney1', remainingMoney);
    document.getElementById('user-money').textContent = remainingMoney;

    localStorage.setItem('lastVisitTime', now.toISOString());
    localStorage.setItem(COMPANY.KEY, JSON.stringify(validCompanies));
    
    renderCompanies();
}

function renderCompanies() {
    const container = document.getElementById('companiesContainer');
    const companies = JSON.parse(localStorage.getItem(COMPANY.KEY)) || [];
    let totalProfitAll = 0;
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
    const existingProfitElement = document.getElementById('total-companies-profit');
    if(existingProfitElement) {
        existingProfitElement.remove();
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    container.innerHTML = companies.map(company => {
        const totalProfit = company.budget - company.initialBudget;
        totalProfitAll += totalProfit;
        
        const statusClass = totalProfit >= 0 ? 'profit-up' : 'profit-down';
        const statusText = company.budget > 0 ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ë–∞–Ω–∫—Ä–æ—Ç';
        
        const lastProfit = company.lastProfit 
            ? `–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: ${company.lastProfit >= 0 ? '+' : ''}${company.lastProfit.toFixed(2)}‚ÇΩ<br>`
            : '';

        return `
            <div class="inventory-item">
                <h3>${company.name}</h3>
                <img src="${company.avatar}" style="width:60px; height:60px; border-radius:8px;">
                <p>–ö–∞–ø–∏—Ç–∞–ª: ${Math.floor(company.budget).toLocaleString()}‚ÇΩ</p>
                <p class="${statusClass}">
                    ${lastProfit}
                    –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: ${totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)}‚ÇΩ
                </p>
                <p>–°—Ç–∞—Ç—É—Å: <span class="${company.budget > 0 ? 'profit-up' : 'profit-down'}">
                    ${statusText}
                </span></p>
                <div class="company-actions">
                    <button class="company-btn fund-btn" onclick="fundCompany(${company.id})">–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="company-btn delete-btn" onclick="deleteCompany(${company.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        `;
    }).join('');

    // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
    const totalProfitElement = document.createElement('div');
    totalProfitElement.id = 'total-companies-profit';
    totalProfitElement.textContent = `–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: ${totalProfitAll.toLocaleString()}‚ÇΩ`;
    totalProfitElement.style.color = totalProfitAll >= 0 ? '#4CAF50' : '#ff4444';
    totalProfitElement.style.marginTop = '20px';
    totalProfitElement.style.padding = '10px';
    
    container.parentNode.insertBefore(totalProfitElement, container.nextSibling);
}

function fundCompany(companyId) {
    const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è:');
    if(!amount || isNaN(amount)) return;
    
    const companies = JSON.parse(localStorage.getItem(COMPANY.KEY));
    const company = companies.find(c => c.id === companyId);
    const userBalance = Number(localStorage.getItem('userMoney1'));
    
    if(amount > userBalance) {
        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
        return ;
    }
        company.budget += Number(amount);
        localStorage.setItem('userMoney1', userBalance - amount);
        localStorage.setItem(COMPANY.KEY, JSON.stringify(companies));
        updateCompanies();
}

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
function deleteCompany(companyId) {
    if(!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
    
    const companies = JSON.parse(localStorage.getItem(COMPANY.KEY));
    const filtered = companies.filter(c => c.id !== companyId);
    
    localStorage.setItem(COMPANY.KEY, JSON.stringify(filtered));
    updateCompanies();
    alert('–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
}
</script>
<div class="category-section" id="promoSection">
                <input type='text' id="promo" style="width: 90%;" placeholder="–í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞">
                <button onclick="getpromo(document.getElementById('promo').value)" 
                        style="border: 1px solid white; background-color: black; color: white; border-radius: 5px; padding: 15px; margin: 15px;">
                    –ü–æ–ª—É—á–∏—Ç—å
                </button>
                
                <div class="category-title">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</div>
                <div class="promosgen">
                    <input type="number" id="value1" placeholder="–¶–µ–Ω–∞">
                    <input type="text" id="value2" placeholder="–ü–æ–ª—É—á–∞—Ç–µ–ª—å">
                    <p style='opacity: 0.6'>–£—á–∏—Ç—ã–≤–∞–π—Ç–µ, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞ –≤–∞—à —Å—á–µ—Ç<br>–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ —Å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º –ø—É—Å—Ç—ã–º, —á—Ç–æ –±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –æ–±—â–∏–º<br>–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Å–≤–æ–∏ –∂–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</p>
                    <button class='pay-button' onclick="encrypt()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                    <p id="encryptedResult" onclick='copytext("encryptedResult")'></p>
                </div>
            </div>
<!-- Other Section -->
            <div class="category-section" id="otherSection">
                <div class="i1">
                    <div class="item-name">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</div>
                    <div class="quantity-control">
                        <input type='number' min="0" id="pev" value="0">
                        <input type="text" id="pev1" placeholder="–° –∫–∞–∫–æ–π —Ü–µ–ª—å—é?">
                    </div>
                    <button class="pay-button" onclick='dep()'>–ü–µ—Ä–µ–≤–æ–¥</button>
                    
                </div>
                
                <div class="category-title">–ö—Ä–µ–¥–∏—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
                <div class="credit-section" style="padding:20px; border:1px solid #444; border-radius:8px; margin-bottom:20px;">
                    <div id="activeCredits"></div>
                    <div class="i1">
                        <input type="number" id="loanAmount" placeholder="–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (–º–∏–Ω. 10,000‚ÇΩ, –º–∞–∫—Å. 20,0000‚ÇΩ)" style="width:90%">
                        <input type="number" id="loanTerm" placeholder="–°—Ä–æ–∫ (–¥–Ω–∏, –º–∞–∫—Å. 2)" style="width:90%">
                        <button class="pay-button" onclick="takeLoan()">–í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
                    </div>
                    <p id="loanError" style="color:#ff4444; margin-top:10px;"></p>
                </div>
<div class="sell-system" style="margin-top:20px; padding:15px; border:1px solid #444; border-radius:8px;">
        <h3 style="margin:0 0 15px 0;">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂–∏ –æ–±—ä–µ–∫—Ç–æ–≤</h3>
        <select id="sellItems" style="width:90%; margin-bottom:10px; padding:8px; background:#222; color:white;"></select>
        <input type="number" id="sellQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" 
               style="width:90%; margin-bottom:10px; padding:8px; background:#222; color:white;">
        <button onclick="sellItems()" 
                style="width:100%; padding:10px; background:#27ae60; border:none; color:white; border-radius:5px;">
            –ü—Ä–æ–¥–∞—Ç—å
        </button>
    </div>
    
    <script>
        let itemBasePrices = {};

function initItemPrices() {
    document.querySelectorAll('.item-container').forEach(item => {
        const name = item.querySelector('.item-name').innerText;
        const price = parseInt(item.dataset.price);
        itemBasePrices[name] = price;
    });
}

function populateSellableItems() {
    const inventory = parseInventoryToObject(localStorage.getItem('inventory'));
    const select = document.getElementById('sellItems');
    select.innerHTML = '';
    
    Object.entries(inventory).forEach(([name, qty]) => {
        if(qty > 0 && itemBasePrices[name]) {
            const option = document.createElement('option');
            option.value = name;
            option.innerText = `${name} (${qty} —à—Ç.)`;
            select.appendChild(option);
        }
    });
}

function sellItems() {
    const itemName = document.getElementById('sellItems').value;
    const quantity = parseInt(document.getElementById('sellQuantity').value) || 0;
    const inventory = parseInventoryToObject(localStorage.getItem('inventory'));
    
    if(!itemName || quantity <= 0) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
    if(!inventory[itemName] || inventory[itemName] < quantity) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤!');
    
    const tradeLevel = JSON.parse(localStorage.getItem("guarantsData") || "null")
    ?.guarantsData?.["–¢–æ—Ä–≥–æ–≤–ª—è"]?.currentTier || 0;
    const sellMultiplier = 0.4 + (tradeLevel * 0.03);
    const totalValue = Math.round(itemBasePrices[itemName] * quantity * sellMultiplier);
    

    inventory[itemName] -= quantity;
    if(inventory[itemName] === 0) delete inventory[itemName];
    
    localStorage.setItem('inventory', Object.entries(inventory).map(([n,q]) => `${n} √ó ${q}`).join('\n'));
    document.getElementById('inv').innerText = localStorage.getItem('inventory');
    
    const newMoney = parseInt(localStorage.getItem('userMoney1')) + totalValue;
    localStorage.setItem('userMoney1', newMoney);
    document.getElementById('user-money').textContent = newMoney;
    
    populateSellableItems();
    alert(`–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–∞–Ω–æ –Ω–∞ ${totalValue}‚ÇΩ!`);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
    initItemPrices();
    populateSellableItems();
});
    </script>
                <button class='pay-button delete' style='background-color: red;' onclick='deleteStrg()'>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
            </div>
         
        </div>
<script>
    
    function copytext(e) {
    const text = document.getElementById(e).innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
    }).catch((err) => {
        alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: " + err);
    });
}

        function encrypt() {
             const value1 = document.getElementById('value1').value;
            const value2 = document.getElementById('value2').value;
            
            if (value1.length > 0 && value2.length >= 0 && remainingMoney > value1) {
                
            remainingMoney -= value1
            localStorage.setItem("userMoney1", remainingMoney)
            
            // –ö–æ–¥–∏—Ä—É–µ–º –¥–ª–∏–Ω—É value1 –≤ –ø–µ—Ä–≤–æ–º —Å–∏–º–≤–æ–ª–µ
            const lengthByte = String.fromCharCode(value1.length + 32);
            const combined = lengthByte + value1 + value2;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å–¥–≤–∏–≥
            let shifted = Array.from(combined).map((c, i) => {
                let code = c.charCodeAt(0);
                return String.fromCharCode((code - 32 + i + 1) % 95 + 32);
            }).join('');
            
            // –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ—á–µ—Ç–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            let chars = [...shifted];
            let oddChars = chars.filter((_, i) => i % 2).reverse();
            chars = chars.map((c, i) => i % 2 ? oddChars[Math.floor(i/2)] : c);
            
            document.getElementById('encryptedResult').textContent = chars.join('');
            
            const usedPromos = JSON.parse(localStorage.getItem('usedPromos') || '[]');
            
            usedPromos.push(chars.join(''));
            
            localStorage.setItem('usedPromos', JSON.stringify(usedPromos))
        } else {
        alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º—É –∏–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è! (–∏–ª–∏ —É –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤)");
        }
    }

        function decrypt(encrypted) {
            let chars = [...encrypted];
            let oddChars = chars.filter((_, i) => i % 2).reverse();
            chars = chars.map((c, i) => i % 2 ? oddChars[Math.floor(i/2)] : c);
            
            // –û–±—Ä–∞—Ç–Ω—ã–π —Å–¥–≤–∏–≥
            let decrypted = chars.map((c, i) => {
                let code = c.charCodeAt(0);
                return String.fromCharCode((code - 32 - i - 1 + 95) % 95 + 32);
            }).join('');
            
            try {
                const length = decrypted.charCodeAt(0) - 32;
                const value1 = decrypted.substr(1, length);
                const value2 = decrypted.substr(1 + length);
                if (!isNaN(Number(value1)) && value1.length > 0) {
                return [value1, value2];
            } else {
                alert("–ü—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
            }
            } catch(e) {
             console.error(e)
            }
        }
    </script>
<div class="bottom-nav">
    <div class="nav-item active" data-section="shopSection">üõí</div>
    <div class="nav-item" data-section="inventorySection">üéí</div>
    <div class="nav-item" data-section="companiesSection">üè¢</div>
    <div class="nav-item" data-section="happinessSection">üòä</div>
    <div class="nav-item" data-section="promoSection">üé´</div>
    <div class="nav-item" data-section="otherSection">‚öôÔ∏è</div>
</div></div>
</div>
<script>
function showSection(sectionId) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
    document.querySelectorAll('.category-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
    const activeSection = document.getElementById(sectionId);
    if(activeSection) {
        activeSection.classList.add('active');
    
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.nav-item').forEach(item => {
        const isActive = item.getAttribute('data-section') === sectionId;
        item.classList.toggle('active', isActive);
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
        const sectionId = item.getAttribute('data-section');
        showSection(sectionId);
    });
});

// –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é —Å–µ–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
    showSection('shopSection');
});
</script>
<script>
    
const promos = {
  "2025": 1000000,
  "imancat": 400000,
  "kenihukc": 200000,
  "–∏—Ä–æ–Ω–º–∞–∫—Å2005": 300000,
  "–∏–¥–∏–æ—Ç—ã,—è–Ω–µ–¥–∞—é–¥–µ–Ω—å–≥–∏–ø—Ä–æ—Å—Ç–æ—Ç–∞–∫": 600000,
  "admitone": 200000,
  "–ø—Ä–æ–º–æ": 350000,
  "–ø—Ä–æ–º–æ–∫–æ–¥_2025_—ë–ª–∫–∏_–º–∏–ª–ª–∏–æ–Ω_–¥–µ–Ω–µ–≥": -1000,
  "–≤–∞—Ç–∏–∫–∞–Ω": 100000,
  "–±—Ä–∞–∑–∏–ª–∏–∞": 80000,
  "–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è—Å–∏—Å—Ç–µ–º–∞—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π": 50000,
  "—É–ª—ã–±–∫–∞": 150000
};

function getpromo(p) {
  if (typeof p !== 'string') p = String(p);
  p = p.trim().replace(/\s+/g, '').toLowerCase();
  const usedPromos = JSON.parse(localStorage.getItem('usedPromos') || '[]');

  if (usedPromos.includes(p)) {
    alert("–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!");
    return;
  }

  if (promos[p]) {
    alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${promos[p]}! –ü–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –≤ –±–æ—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è!`);
    localStorage.setItem('userMoney1', Number(localStorage.getItem('userMoney1') || 0) + promos[p]);
    usedPromos.push(p);
    localStorage.setItem('usedPromos', JSON.stringify(usedPromos));
    fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `üî•<b> –ü—Ä–æ–º–æ–∫–æ–¥ –ø–æ–ª—É—á–µ–Ω!</b> \n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–¶–µ–Ω–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞: ${promos[p]}‚ÇΩ`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
  } else {
    const ps = decrypt(p);
    if (user.username.toLowerCase().trim() === ps[1].toLowerCase().trim() || ps[1].length == 0) {
        alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ —Ü–µ–Ω–æ–π –≤ ${ps[0]}!`);
        // –ó–¥–µ—Å—å –±—ã–ª–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ —Å–∫–æ–±–∫–∞
        localStorage.setItem('userMoney1', Number(localStorage.getItem('userMoney1') || 0) + Number(ps[0]));
        usedPromos.push(p);
        localStorage.setItem('usedPromos', JSON.stringify(usedPromos));
        fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `üî•<b> –ü—Ä–æ–º–æ–∫–æ–¥ –ø–æ–ª—É—á–µ–Ω!</b> \n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–¶–µ–Ω–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞: ${ps[0]}‚ÇΩ\n–¢–∏–ø –ø—Ä–æ–º–æ–∫–æ–¥–∞: –∫–∞—Å—Ç–æ–º–Ω—ã–π`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
    } else {
        alert("–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω!");
    } } }

    
    function dep() {
        let x = document.getElementById("pev").value
        let y = document.getElementById("pev1").value
        if (x <= remainingMoney && x.length > 0 && y.length > 0) {
        remainingMoney -= x;
        localStorage.setItem('userMoney1', remainingMoney);
        alert(`–í—ã —Ö–æ—Ç–∏—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å: ${x} ‚ÇΩ. –í–∞—à –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${remainingMoney} ‚ÇΩ`);
        fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `‚úÖ <b>${x}‚ÇΩ - –ø–µ—Ä–µ–≤–æ–¥!</b> \n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–¶–µ–ª—å: ${y}`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
    } else {
        alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º—É –∏–ª–∏ —Ü–µ–ª—å! (–∏–ª–∏ —É –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤)");
    }
    }
    
    function deleteStrg() {
            localStorage.removeItem('inventory')
            localStorage.removeItem('userMoney1')
            localStorage.removeItem('usedPromos')
            localStorage.removeItem('userCompanies')
            localStorage.removeItem('guarantsData')
            localStorage.removeItem('loans');
            localStorage.removeItem('loanBlocked');
            window.location.reload()
    }
    
    document.querySelectorAll('.item-container input').forEach(input => {
    input.setAttribute('oninput', 'this.value = Math.abs(this.value)');
});

document.addEventListener('keydown', (event) => {
        if (event.key === '-') {
            event.preventDefault();
        }
    })



    function parsinv(text) {
    const inventory = {};

    // –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏
    const lines = text.trim().split('\n');

    lines.forEach(line => {
        // –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ —Å–∏–º–≤–æ–ª—É '√ó'
        if (line.includes('√ó')) {
            const [item, quantity] = line.split('√ó').map(part => part.trim());
            const qty = parseInt(quantity, 10);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –æ–±—ä–µ–∫—Ç –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (inventory[item]) {
                inventory[item] += qty;
            } else {
                inventory[item] = qty;
            }
        }
    });

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É
    const result = Object.entries(inventory)
        .map(([item, quantity]) => `${item} √ó ${quantity}`)
        .join('\n');

    return result;
}

function sendCash(cost, remain, bought) {
    fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `üí† <b>${cost}‚ÇΩ - –ø—Ä–∏–±—ã–ª—å!</b> \n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–°—á—ë—Ç: ${remain}‚ÇΩ\n–ë–∞–ª–ª—ã –∞—Ä–º–∏–∏: ${armyballs}\n–ù–∞–ª–æ–≥: ${taxr}‚ÇΩ\n–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:\n-------\n${bought}`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
}

</script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let user;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Telegram Web App, —Å–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if (true) {
            //localStorage.setItem('userMoney', 5);
            user = {
                first_name: "–ü—Ä<br>",
                last_name: "–í–∞—à–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è<br>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç",
                username: "iron",
                photo_url: 'https://masterpiecer-images.s3.yandex.net/5fb594277c19885:upscaled'
            };
        } else {
            Telegram.WebApp.ready();
            user = Telegram.WebApp.initDataUnsafe.user;
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('avatar').src = user.photo_url || 'https://via.placeholder.com/100';
        document.getElementById('name').innerHTML = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        document.getElementById('username').innerText = '@' + (user.username || 'unknown');
        
        const users = {
            'iron': { money: 99999999999 }
        };
        
//localStorage.removeItem("userMoney1")
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const currentUserMoney = users[user.username] ? users[user.username].money : 6000000;
        let totalCost = 0;
        let remainingMoney = currentUserMoney;
    
        if (!localStorage.getItem("if3")) {
            deleteStrg()
            localStorage.setItem("if3", true)
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤ localStorage
        if (!localStorage.getItem('userMoney1')) {
            localStorage.setItem('userMoney1', currentUserMoney);
        } else {
            remainingMoney = parseInt(localStorage.getItem('userMoney1'));
        }

       function updateTotalCost() {
    totalCost = 0;
    let boughtItems = '';
    const guarantsData = JSON.parse(localStorage.getItem('guarantsData') || '{}');

    const itemContainers = document.querySelectorAll('.item-container');
    itemContainers.forEach(item => {
        const input = item.querySelector('input');
        if (!input) return;

        const quantity = parseInt(input.value) || 0;
        const basePrice = parseInt(item.dataset.price) || 0;
        const itemName = item.querySelector('.item-name')?.innerText.trim();

        if (quantity > 0) {
            boughtItems += `${itemName} √ó ${quantity}\n`;
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫–∏ –æ—Ç –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≥–∞—Ä–∞–Ω—Ç–æ–≤
        let finalPrice = basePrice;
        Object.entries(guarantsData).forEach(([key, guarant]) => {
    if (guarant.items.includes(itemName) || key === "–¢–æ—Ä–≥–æ–≤–ª—è") {
        finalPrice *= 1 - (guarant.currentTier * guarant.discountPerTier);
    }
});

        totalCost += finalPrice * quantity * (taxr + 1);
    });

    if (boughtItems !== '') {
        const itemsCount = boughtItems.split('\n').length - 1;
        const tovar = itemsCount === 1 ? '—Ç–æ–≤–∞—Ä' : 
                     itemsCount >= 2 && itemsCount <= 4 ? '—Ç–æ–≤–∞—Ä–∞' : '—Ç–æ–≤–∞—Ä–æ–≤';
        boughtItems += `-------\n–í—Å–µ–≥–æ: ${itemsCount} ${tovar}`;
    }

    document.getElementById('total-cost').textContent = Math.round(totalCost);
    document.getElementById('remaining-money').textContent = Math.round(remainingMoney - totalCost);

    return boughtItems;
}
function updateTotalCostinv() {
    totalCost = 0;
    let boughtItems = ''; // –°—Ç—Ä–æ–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

    const itemContainers = document.querySelectorAll('.item-container');
    itemContainers.forEach(item => {
        const quantity = parseInt(item.querySelector('input').value);
        const price = parseInt(item.getAttribute('data-price'));
        const itemName = item.querySelector('.item-name').innerText;
        
        if (quantity > 0) {
            boughtItems += `${itemName} √ó ${quantity}\n`;
        }
        
        totalCost += quantity * price;
    });

    return boughtItems;
}


        
        document.querySelectorAll('.quantity-control input').forEach(input => {
    input.addEventListener('input', function() {
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—å—à–µ 0
        if (this.value < 0) this.value = 0; 
        updateTotalCost();
    });
});

        function sendItem(cost, remain, bought) {
    fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `üí± <b>${cost}‚ÇΩ </b>\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–°—á—ë—Ç: ${remain}\n\n–ö—É–ø–ª–µ–Ω–æ:\n-------\n${bought}`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
}

        function sendItemdis(cost, remain, bought) {
    fetch(`https://api.telegram.org/bot${xr(window.tkn)}/sendMessage`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            chat_id: '-1002485443398',
            text: `‚ùå <b>${cost}‚ÇΩ </b>\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${user.username}\n–°—á—ë—Ç: ${remain}\n\n–û—Ç–∫–∞–∑–∞–Ω–æ:\n-------\n${bought}`, 
            message_thread_id: 23,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
}

        function pay() {
    if (totalCost <= remainingMoney) {
        remainingMoney -= totalCost;
        localStorage.setItem('userMoney1', remainingMoney);
        const boughtItems = updateTotalCost();
        const inventar = `${localStorage.getItem('inventory')}${updateTotalCostinv()}`
        localStorage.setItem('inventory', `${parsinv(inventar)}\n`);
        document.getElementById('inv').innerText = localStorage.getItem('inventory');
        alert(`–í—ã —Ö–æ—Ç–∏—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å: ${totalCost} ‚ÇΩ. –í–∞—à –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${remainingMoney} ‚ÇΩ`);
        sendItem(totalCost, remainingMoney, boughtItems); // –ü–µ—Ä–µ–¥–∞–µ–º –≤ sendItem
    } else {
        alert("–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
        const boughtItems = updateTotalCost(); // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
        sendItemdis(totalCost, remainingMoney, boughtItems);
    }
    calculateHappiness();
}
        if (localStorage.getItem('inventory') === null) {
            localStorage.setItem('inventory', '');
        }
        document.getElementById('inv').innerText = parsinv(localStorage.getItem('inventory'));
        document.getElementById('user-money').innerText = remainingMoney
        
        function parseInventoryToObject(text) {
    const inventory = {};
    let lines;

    if (typeof(text) == 'string') {
        lines = text.trim().split('\n');
    } else {
        return [];
    }

    lines.forEach(line => {
        // –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ —Å–∏–º–≤–æ–ª—É '√ó'
        if (line.includes('√ó')) {
            const [item, quantity] = line.split('√ó').map(part => part.trim());
            const qty = parseInt(quantity, 10);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –æ–±—ä–µ–∫—Ç –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (inventory[item]) {
                inventory[item] += qty;
            } else {
                inventory[item] = qty;
            }
        }
    });

    return inventory;
}
    </script>
    <script>
const earningsPerMinute = {
    // –≠–∫–æ–Ω–æ–º–∏–∫–∞ (item-id 31-46)
    "–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞": 25 / 1200,
    "–ó–∞–≤–æ–¥": 30 / 1200,
    "–ê—ç—Ä–æ–ø–æ—Ä—Ç": 40 / 1200,
    "–ë–∞–Ω–∫": 80 / 1200,
    "–§–µ—Ä–º–∞": 40 / 1200,
    "–ì–æ—Ä–Ω–æ–¥–æ–±—ã–≤–∞—é—â–∞—è —Ñ–∞–±—Ä–∏–∫–∞": 35 / 1200,
    "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä": 70 / 1200,
    "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è": 115 / 1200,
    "–†—ã–Ω–æ–∫": 60 / 1200,
    "–ú–µ–ª—å–Ω–∏—Ü–∞": 1 / 1200,
    "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è": 35 / 1200,
    "–ù–µ—Ñ—Ç–µ–ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –∑–∞–≤–æ–¥": 55 / 1200,
    "IT-–ö–ª–∞—Å—Ç–µ—Ä": 90 / 1200,
    "–°–µ—Ç—å –ê–ó–°": 45 / 1200,
    "–ö—Ä–∏–ø—Ç–æ—Ñ–µ—Ä–º–∞": 150 / 1200,
    "–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ö–∞–±": 65 / 1200
};

const army = {
    // –ê—Ä–º–∏—è (item-id 16-30)
    "–¢–∞–Ω–∫": 5,
    "–°–∞–º–æ–ª–µ—Ç": 15,
    "–í–µ—Ä—Ç–æ–ª–µ—Ç": 3,
    "–†–∞–∫–µ—Ç–Ω–∏—Ü–∞": 1,
    "–ü—É—à–∫–∏": 2,
    "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞": 5,
    "–ü–æ–¥–≤–æ–¥–Ω–∞—è –ª–æ–¥–∫–∞": 6,
    "–ì–∞—Ä–Ω–∏–∑–æ–Ω": 8,
    "–ú–æ—Ä—Å–∫–æ–π —Ñ–ª–æ—Ç": 12,
    "–°–æ–ª–¥–∞—Ç": 1,
    "–ë–æ–µ–≤–æ–π –¥—Ä–æ–Ω": 4,
    "–†–∞–∫–µ—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞": 9,
    "–ë—Ä–æ–Ω–µ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä": 7,
    "–ò—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å": 18,
    "–í–æ–µ–Ω–Ω–∞—è —Ä–∞–∑–≤–µ–¥–∫–∞": 2
};

function parseto(text) {
    text = String(text);
    const inventory = {};
    const lines = text.trim().split('\n');
    lines.forEach(line => {
        if (line.includes('√ó')) {
            const [item, quantity] = line.split('√ó').map(part => part.trim());
            const qty = parseInt(quantity, 10);
            if (inventory[item]) {
                inventory[item] += qty;
            } else {
                inventory[item] = qty;
            }
        }
    });

    return inventory;
}

function parsetoarmy(text) {
    text = String(text);
    const inventory = {};
    const lines = text.trim().split('\n');
    
    lines.forEach(line => {
        if (line.includes('√ó')) {
            const [item, quantity] = line.split('√ó').map(part => part.trim());
            const qty = parseInt(quantity, 10);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∞—Ä–º–∏–∏
            if (army[item] !== undefined) {
                if (inventory[item]) {
                    inventory[item] += qty;
                } else {
                    inventory[item] = qty;
                }
            }
        }
    });

    return inventory;
}

function calcpoints(inventory) {
    let totalPoints = 0;

    for (let item in inventory) {
        if (army[item] !== undefined) {
            totalPoints += inventory[item] * army[item];
        }
    }

    return totalPoints;
}
let taxr = 0;

function taxes(profit) {
    if (profit <= 30000) return 0;
    const BREAKPOINT = 700;
    const TARGET_PROFIT = 1000000000;
    const MIN_RATE = 1;
    const MAX_RATE = 70;
    const logProfit = Math.log10(profit);
    const logMin = Math.log10(BREAKPOINT);
    const logMax = Math.log10(TARGET_PROFIT);
    let taxRate = MIN_RATE + 
        ((logProfit - logMin) / (logMax - logMin)) * 
        (MAX_RATE - MIN_RATE);
    taxRate = Math.min(taxRate, MAX_RATE);
    taxRate = Math.max(taxRate, MIN_RATE);
    if(HAPPINESS.CURRENT < 25) {
        taxRate += 2;
    }
    return Number(Number((profit * (taxRate / 100)).toFixed(2)) * 0.65);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
function calculate(inventoryText) {
    const inventory = parseto(inventoryText);
    const currentTime = new Date();
    const lastVisitTime = localStorage.getItem('lastVisitTime');
    let totalEarnings = 0;

    if (!lastVisitTime) {
        localStorage.setItem('lastVisitTime', currentTime.toISOString());
    } else {
        const lastVisit = new Date(lastVisitTime);
        const timeDifference = Math.floor((currentTime - lastVisit) / (100 * 80) * 1.35);
        
        if (timeDifference > 0) {
            for (const item of Object.keys(earningsPerMinute)) {
                if (inventory[item]) {
                    const quantity = inventory[item];
                    const perMinute = earningsPerMinute[item] || 0.45 / 100;
                    totalEarnings += quantity * perMinute * timeDifference;
                }
            }
            const companies = JSON.parse(localStorage.getItem(COMPANY.KEY)) || [];
            const medical = inventory['–ë–æ–ª—å–Ω–∏—Ü–∞'] || 0;
            const education = (inventory['–®–∫–æ–ª–∞'] || 0) + (inventory['–£—á–µ–Ω—ã–π'] || 0);
            const employment = (inventory['–ó–∞–≤–æ–¥'] || 0) + companies.length;
            
            // –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏—Ä–æ—Å—Ç —Å —É—á–µ—Ç–æ–º —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            let growthRate = 1 + 
                (medical * 0.15) + 
                (education * 0.10) + 
                (employment * 0.20);
            
            // –í–ª–∏—è–Ω–∏–µ —Å—á–∞—Å—Ç—å—è
            growthRate *= HAPPINESS.CURRENT / 100;
            let population = localStorage.getItem("population")
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∂–∏–ª—å–µ–º
            const housing = inventory['–ñ–∏–ª–æ–π –¥–æ–º'] || 0;
            const maxPopulation = housing * 500;
            if(population > maxPopulation && maxPopulation > 0) {
                growthRate *= 0.25; // –®—Ç—Ä–∞—Ñ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏–∏
            }

            // –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è
            const randomFactor = 0.9 + Math.random() * 0.2;
            
           population = Math.round(population * (1 + (growthRate * timeDifference / 1000))) * randomFactor;
           population = isNaN(population) ? 1000 : population;
           localStorage.setItem('population', population);
            
            localStorage.setItem('population', population);
        }
    }
    
    

    // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞–ª–æ–≥ –¢–û–õ–¨–ö–û –æ—Ç –ø—Ä–∏–±—ã–ª–∏
    const taxAmount = taxes(totalEarnings);
    if (taxAmount > 0) {
        taxr = taxAmount;
        document.getElementById("taxrate").innerText = taxAmount
    }
    const netProfit = totalEarnings - taxAmount;

    localStorage.setItem('lastVisitTime', currentTime.toISOString());
    return Math.floor(netProfit); 
}
let inv_nonparsed = localStorage.getItem('inventory')
let inv_parsed = calculate(inv_nonparsed)
var armyballs = parseInt(calcpoints(parsetoarmy(inv_nonparsed)));
sendCash(parseInt(inv_parsed), parseInt(localStorage.getItem('userMoney1')) + calculate(inv_nonparsed), parsinv(inv_nonparsed))
if (inv_parsed > 0) {
    let currentBalance = Number(localStorage.getItem('userMoney1')) || 0;
    currentBalance += inv_parsed;
    localStorage.setItem('userMoney1', currentBalance);
}
localStorage.setItem('userMoney1', Math.max(0, localStorage.getItem('userMoney1')))
remainingMoney = localStorage.getItem('userMoney1')
document.getElementById('user-money').innerText = remainingMoney
document.getElementById('armyb').innerText = armyballs;
</script>
</body>
</html>
